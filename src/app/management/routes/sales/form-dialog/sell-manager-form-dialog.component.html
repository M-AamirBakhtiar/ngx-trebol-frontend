<div class="dialog">
  <h2 mat-dialog-title>{{ dialogTitle }}</h2>
  <centered-mat-spinner *ngIf="saving$ | async">
  </centered-mat-spinner>

  <div [hidden]="saving$ | async">
    <form [formGroup]="formGroup" (submit)="onSubmit()">

      <mat-form-field style="grid-area: date">
        <input matInput placeholder="Fecha" [ngModel]="sellDate" [ngModelOptions]="{ standalone: true }" disabled />
      </mat-form-field>

      <mat-form-field style="grid-area: type">
        <mat-select placeholder="Tipo de Venta" formControlName="type">
          <mat-option *ngFor="let t of (sellTypes$ | async)" [value]="t.codigo">
            {{ t.description }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field style="grid-area: seller">
        <mat-select placeholder="Vendedor" formControlName="employee">
          <mat-option *ngFor="let e of (employees$ | async)" [value]="e.id">
            {{ e.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field style="grid-area: client">
        <mat-select placeholder="Cliente" formControlName="client">
          <mat-option *ngFor="let c of (clients$ | async)" [value]="c.id">
            {{ c.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-card style="grid-area: details">
        <div class="details-header">
          <h3>Productos de esta Venta</h3>
          <button mat-button mat-raised-button color="primary"
            (click)="onClickAddProducts()">
            Agregar
          </button>
        </div>
        <div class="details-table-wrapper">
          <table mat-table #detailsTable [dataSource]="sellDetails$">
            <ng-container matColumnDef="product">
              <th mat-header-cell *matHeaderCellDef> Nombre </th>
              <td mat-cell *matCellDef="let detail" class="left">
                {{ detail.name }}
              </td>
            </ng-container>
            <ng-container matColumnDef="price">
              <th mat-header-cell *matHeaderCellDef> Precio </th>
              <td mat-cell *matCellDef="let detail" class="left">
                ${{ detail.product.price }}
              </td>
            </ng-container>
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef> Cantidad </th>
              <td mat-cell *matCellDef="let detail; let i=index" class="left">
                <div>
                  <button mat-button mat-icon-button
                    (click)="onClickIncreaseDetailProductQuantity(i)">
                    <mat-icon>add</mat-icon>
                  </button>
                  {{ d.units }}
                  <button mat-button mat-icon-button
                    [disabled]="(detail.units < 2)"
                    (click)="onClickDecreaseDetailProductQuantity(i)">
                    <mat-icon>remove</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> </th>
              <td mat-cell *matCellDef="let i=index">
                <div>
                  <button mat-button mat-icon-button color="warn"
                    (click)="onClickBorrarDetalle(i)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: tableColumns;"></tr>
          </table>
        </div>
      </mat-card>

      <div class="summary">
        <div>Subtotal: ${{ sellSubtotalValue$ | async }}</div>
        <div>Total: ${{ sellTotalValue$ | async }}</div>
      </div>

      <div class="actions">
        <button mat-button mat-raised-button
          color="primary"
          [disabled]="formGroup.invalid">
          Aceptar
        </button>
        <button mat-button mat-raised-button (click)="onCancel()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

</div>
